 
version: 2.1 # Use v2.1 to enable orb usage.

# The Windows orb gives you everything you
# need to start using the Windows executor.
orbs:
  win: circleci/windows@2.2.0

jobs:
  hello: # name of your job
    executor: win/default # executor type

    steps:
      # Commands are run in a Windows
      # virtual machine environment
      - checkout
      - run: Write-Host 'Hello, Windows'
  
  nukeeper:
    executor: win/default
    steps:
      - checkout
      - run:
          name: Install nukeeper 
          command: |
            dotnet tool install nukeeper --global
            mkdir -p ~/logs/
      - attach_workspace:
          at: ~/
      - run:
          name: nukeeper inspect
          command: |
            nukeeper inspect >> ~/logs/nukeeper.txt
            Get-Content ~/logs/nukeeper.txt
            $SEL = select-string -path ~/logs/nukeeper.txt -pattern "0 possible"
            if ($SEL -ne $null)
            {
                echo Contains NO package to update
                exit 0
            }
            else
            {
                echo Contains PACKAGES to UPDATE
                exit 1
            }

workflows:
  default:
    jobs:
      - hello
      - nukeeper:
          requires: [hello]